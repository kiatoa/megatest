<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<meta name="generator" content="http://www.nongnu.org/elyxer/"/>
<meta name="create-date" content="2012-01-29"/>
<link rel="stylesheet" href="http://elyxer.nongnu.org/lyx.css" type="text/css" media="all"/>
<title>Megatest User Manual</title>
</head>
<body>
<div id="globalWrapper">
<div class="Standard">

</div>
<div class="Standard">

</div>
<div class="Standard">

</div>
<h1 class="title">
Megatest User Manual
</h1>
<h2 class="author">
Matthew Welland
</h2>
<h2 class="Date">
Jan. 29, 2012 
</h2>
<div class="Standard">
<p><br/>
</p>
©2011 Matthew Welland. All rights reserved. 
</div>
<div class="Standard">
Megatest is free software released under the General Public License v2.0. Please see the file COPYING in the source distribution for details. 
</div>
<div class="Standard">
<div class="medskip"> </div>Email: matt@kiatoa.com. 
</div>
<div class="Standard">
Web: www.kiatoa.com/fossils/megatest
</div>
<div class="Standard">
<div class="medskip"> </div>This document is believed to be acurate at the time of writing but as with any opensource project the source code itself is the reference. It is the responsibility of the end user to validate that the code will perform as they expect. The author assumes no responsibility for any inaccuracies that this document may contain. In no event will Matthew Welland be liable for direct, indirect, special, exemplary, incidental, or consequential damages resulting from any defect or omission in this document, even if advised of the possibility of such damages. 
</div>
<div class="Standard">
This document is a snapshot in time and Megatest software has likely changed since publication. This document and Megatest may be improved at any time, without notice or obligation. 
</div>
<div class="Standard">
<p><br/>
</p>

</div>
<h1 class="Section-">
<a class="toc" name="toc-Section--1"></a>Megatest/document Revision History
</h1>
<div class="Standard">
<i>Notable revisions of the software are occasionally documented here</i>.
</div>
<div class="Standard">
<div class="center">
<table>
<tr>
<td align="center" valign="top" style="width: 0.5in;">
Version
</td>
<td align="center" valign="top" style="width: 0.5in;">
Author
</td>
<td align="justify" valign="top" style="width: 3in;">
Description
</td>
<td align="center" valign="top" style="width: 1in;">
Date
</td>

</tr>
<tr>
<td align="center" valign="top" style="width: 0.5in;">
v1.25
</td>
<td align="center" valign="top" style="width: 0.5in;">
matt
</td>
<td align="justify" valign="top" style="width: 3in;">
converted to new document template
</td>
<td align="center" valign="top" style="width: 1in;">
<span class="unknown">\thedate</span>
</td>

</tr>

</table>

</div>

</div>
<div class="Standard">
<p><br/>
</p>
<div class="fulltoc">
<div class="tocheader">
Table of Contents
</div>
<div class="tocindent">
<div class="toc">
<a class="Link" href="#toc-Section--1">Section: Megatest/document Revision History</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Section-1">Section 1: Introduction</a>
</div>
<div class="tocindent">
<div class="toc">
<a class="Link" href="#toc-Subsection-1.1">Subsection 1.1: Megatest design philosophy</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsection-1.2">Subsection 1.2: Megatest architecture</a>
</div>
</div>
<div class="toc">
<a class="Link" href="#toc-Section-2">Section 2: Installation</a>
</div>
<div class="tocindent">
<div class="toc">
<a class="Link" href="#toc-Subsection-2.1">Subsection 2.1: Dependencies</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsection-2.2">Subsection 2.2: Build and Install</a>
</div>
</div>
<div class="toc">
<a class="Link" href="#toc-Section-3">Section 3: Setup</a>
</div>
<div class="tocindent">
<div class="toc">
<a class="Link" href="#toc-Subsection-3.1">Subsection 3.1: Create megatest.config</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsection-3.2">Subsection 3.2: Create runconfigs.config</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsection-3.3">Subsection 3.3: Create the tests directory and your first test</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsection-3.4">Subsection 3.4: Create the testconfig file for your test</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsection-3.5">Subsection 3.5: Create your test running script, main.sh</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsection-3.6">Subsection 3.6: Run megatest and watch your run progress</a>
</div>
</div>
<div class="toc">
<a class="Link" href="#toc-Section-4">Section 4: Choose Flow or Unstructured Run?</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Section-5">Section 5: How to Write Tests</a>
</div>
<div class="tocindent">
<div class="toc">
<a class="Link" href="#toc-Subsection-5.1">Subsection 5.1: A Simple Test with one Step</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsection-5.2">Subsection 5.2: Create your testconfig file</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsection-5.3">Subsection 5.3: Create the main.csh script</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsection-5.4">Subsection 5.4: Simple Test with Multiple Steps </a>
</div>
</div>
<div class="toc">
<a class="Link" href="#toc-Section-6">Section 6: Simple Test with Multiple Steps, Some in Parallel</a>
</div>
<div class="tocindent">
<div class="toc">
<a class="Link" href="#toc-Subsection-6.1">Subsection 6.1: The Makefile</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsection-6.2">Subsection 6.2: The main.csh file</a>
</div>
</div>
<div class="toc">
<a class="Link" href="#toc-Section-7">Section 7: Simple Test with Iteration</a>
</div>
<div class="tocindent">
<div class="toc">
<a class="Link" href="#toc-Subsection-7.1">Subsection 7.1: Update your testconfig file for iteration</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsection-7.2">Subsection 7.2: Rewrite your main.csh for iteration</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsection-7.3">Subsection 7.3: Tests with Inter-test dependencies</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsection-7.4">Subsection 7.4: Rolling up Miscellaneous Data</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsection-7.5">Subsection 7.5: Rolling up Runs</a>
</div>
</div>
<div class="toc">
<a class="Link" href="#toc-Section-8">Section 8: Dashboard</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Section-9">Section 9: Generating an OpenDocument Spreadsheet from the Database</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Section-10">Section 10: Introspection</a>
</div>
<div class="tocindent">
<div class="toc">
<a class="Link" href="#toc-Subsection-10.1">Subsection 10.1: Getting previous test paths</a>
</div>
</div>
<div class="toc">
<a class="Link" href="#toc-Section-11">Section 11: Flows</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Section-12">Section 12: Flow Specification and Running (Not released yet)</a>
</div>
<div class="tocindent">
<div class="toc">
<a class="Link" href="#toc-Subsection-12.1">Subsection 12.1: Write your flow file</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsection-12.2">Subsection 12.2: Run the flow</a>
</div>
</div>
<div class="toc">
<a class="Link" href="#toc-Section-13">Section 13: Monitor based running</a>
</div>
<div class="tocindent">
<div class="toc">
<a class="Link" href="#toc-Subsection-13.1">Subsection 13.1: Monitor logic</a>
</div>
</div>
<div class="toc">
<a class="Link" href="#toc-Section-14">Section 14: Reference</a>
</div>
<div class="tocindent">
<div class="toc">
<a class="Link" href="#toc-Subsection-14.1">Subsection 14.1: Configuration file Syntax</a>
</div>
<div class="tocindent">
<div class="toc">
<a class="Link" href="#toc-Subsubsection-14.1.1">Subsubsection 14.1.1: Sections</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsubsection-14.1.2">Subsubsection 14.1.2: Variables</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsubsection-14.1.3">Subsubsection 14.1.3: Includes</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsubsection-14.1.4">Subsubsection 14.1.4: Setting a variable by running a command</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsubsection-14.1.5">Subsubsection 14.1.5: Notes</a>
</div>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsection-14.2">Subsection 14.2: Environment variables</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsection-14.3">Subsection 14.3: megatest.config</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsection-14.4">Subsection 14.4: runconfigs.config file</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsection-14.5">Subsection 14.5: Writing tests</a>
</div>
<div class="tocindent">
<div class="toc">
<a class="Link" href="#toc-Subsubsection-14.5.1">Subsubsection 14.5.1: testconfig file</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsubsection-14.5.2">Subsubsection 14.5.2: Command line</a>
</div>
</div>
</div>
<div class="toc">
<a class="Link" href="#toc-Appendix-A">Appendix A: Data</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Appendix-B">Appendix B: References</a>
</div>
</div>

</div>

</div>
<div class="Standard">
<p><br/>
</p>

</div>
<h1 class="Section">
<a class="toc" name="toc-Section-1">1</a> Introduction
</h1>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-1.1">1.1</a> Megatest design philosophy
</h2>
<div class="Standard">
Megatest is intended to provide the minimum needed resources to make writing a suite of tests and implementing continuous build for software, design engineering or process control (via owlfs for example) without being specialized for any specific problem space. Megatest in of itself does not know what constitutes a PASS or FAIL of a test. In most cases megatest is best used in conjunction with logpro or a similar tool to parse, analyze and decide on the test outcome.
</div>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-1.2">1.2</a> Megatest architecture
</h2>
<div class="Standard">
All data to specify the tests and configure the system is stored in plain text files. All system state is stored in an sqlite3 database. Tests are launched using the launching system available for the distributed compute platform in use. A template script is provided which can launch jobs on local and remote Linux hosts. Currently megatest uses the network filesystem to &ldquo;call home&rdquo; to your master sqlite3 database.
</div>
<h1 class="Section">
<a class="toc" name="toc-Section-2">2</a> Installation
</h1>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-2.1">2.1</a> Dependencies
</h2>
<div class="Standard">
Chicken scheme and a number of &ldquo;eggs&rdquo; are required for building megatest. See the file utils/installall.sh for an automated way to install the dependencies on Linux.
</div>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-2.2">2.2</a> Build and Install
</h2>
<div class="Standard">
Run “make test” to create the megatest executable. You may wish to copy the executable to a centrally accessible location.
</div>
<h1 class="Section">
<a class="toc" name="toc-Section-3">3</a> Setup
</h1>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-3.1">3.1</a> Create megatest.config
</h2>
<div class="Standard">
Create the file megatest.config using the megatest.config template from the tests directory. At a minimum you need the following:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing"># Fields are the keys under which your test runs are organized
[fields]
field1 TEXT
field2 TEXT
​
[jobtools]
# The launcher launches jobs to the local or remote hosts,
# the job is managed on the target host by megatest,
# comment out launcher to run local only. An example launcher
# "nbfake" can be found in the utils directory. 
launcher nbfake
​
# The disks section specifies where the tests will be run. As you
# run out of space in a partition you can add additional disks
# entries.
# Format is:
# name /path/to/area 
[disks]
disk1 /tmp 
</pre>
</div>

</div>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-3.2">3.2</a> Create runconfigs.config
</h2>
<div class="Standard">
This file is used to set environment variables that are run specific. You can simply create an empty file to start.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing"># runconfigs.config
</pre>
</div>

</div>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-3.3">3.3</a> Create the tests directory and your first test
</h2>
<div class="Standard">
<div class="listing">
<pre class="listing">../tests
  ├── megatest.config
  ├── runconfigs.config
  └── tests
     └── mytest
           ├── main.sh
           └── testconfig
</pre>
</div>

</div>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-3.4">3.4</a> Create the testconfig file for your test
</h2>
<div class="Standard">
<div class="listing">
<pre class="listing">[setup]
runscript main.sh
</pre>
</div>

</div>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-3.5">3.5</a> Create your test running script, main.sh
</h2>
<div class="Standard">
<div class="listing">
<pre class="listing">#!/bin/bash
​
$MT_MEGATEST -runstep mystep1 "sleep 20;echo Done" -m "mystep1 is done"
$MT_MEGATEST -test-status :state COMPLETED :status PASS -m "This is a comment"
</pre>
</div>

</div>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-3.6">3.6</a> Run megatest and watch your run progress
</h2>
<div class="Standard">
<div class="listing">
<pre class="listing">megatest :field1 abc :field2 def :runname 2011week08.4a -runall
​
watch megatest -list-runs %
​
# OR use the dashboard
​
dashboard &amp;
</pre>
</div>

</div>
<h1 class="Section">
<a class="toc" name="toc-Section-4">4</a> Choose Flow or Unstructured Run?
</h1>
<div class="Standard">
A flow is a structured and specifically sequenced set of tests. See the Flows chapter to understand the difference.
</div>
<h1 class="Section">
<a class="toc" name="toc-Section-5">5</a> How to Write Tests
</h1>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-5.1">5.1</a> A Simple Test with one Step
</h2>
<div class="Standard">
<div class="listing">
<pre class="listing">mkdir simpletest
cd simpletest
</pre>
</div>

</div>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-5.2">5.2</a> Create your testconfig file
</h2>
<div class="Standard">
<div class="listing">
<pre class="listing"># testconfig
​
[setup]
runscript main.csh
</pre>
</div>

</div>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-5.3">5.3</a> Create the main.csh script
</h2>
<div class="Standard">
Note: Using csh is NOT recommended. Use bash, perl, ruby, zsh or anything other than csh. We use csh here because it is popular in the EDA industry for which Megatest was originally created. 
</div>
<div class="Standard">
<div class="left">
<div class="listing">
<pre class="listing">#!/bin/tcsh -x
​
# run the cpu1 simulation.
#   The step name is "run_simulation"
#   The commandline being run for this step is "runsim cpu1"
#   The logpro file to validate the output from the run is "runsim.logpro"
​
$MT_MEGATEST -runstep run_simulation -logpro runsim.logpro "runsim cpu1"
$MT_MEGATEST -test-status :state COMPLETED :status $?
</pre>
</div>

</div>

</div>
<div class="Standard">
You can now run megatest and the created test directory will contain the new files “run_simulation.html” and “run_simulation.log”. If you are using the dashboard you can click on the run and then push the “View log” button to view the log file in firefox.
</div>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-5.4">5.4</a> Simple Test with Multiple Steps 
</h2>
<div class="Standard">
To run multiple steps simply add them to the main.csh file. Here we add a step to test “cpu2”. The second step that tests cpu2 will only run after the step that tested “cpu1” completes.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">#!/bin/tcsh -x
​
# run the cpu1 simulation.
#   The step name is "run_simulation"
#   The commandline being run for this step is "runsim cpu1"
#   The logpro file to validate the output from the run is "runsim.logpro"
​
$MT_MEGATEST -runstep run_simulation_cpu1 -logpro runsim.logpro "runsim cpu1" &amp;&amp; \
$MT_MEGATEST -runstep run_simulation_cpu2 -logpro runsim.logpro "runsim cpu2"
$MT_MEGATEST -test-status :state COMPLETED :status $?
</pre>
</div>

</div>
<h1 class="Section">
<a class="toc" name="toc-Section-6">6</a> Simple Test with Multiple Steps, Some in Parallel
</h1>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-6.1">6.1</a> The Makefile
</h2>
<div class="Standard">
A good way to run steps in parallel within a single test, especially when there are following steps, is to use the Unix Make utility. Writing Makefiles is beyond the scope of this document but here is a minimal example that will run “runsim cpu1” and “runsim cpu2” in parallel. For more information on make try “info make” at the Linux command prompt.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing"># Example Makefile to run two steps in parallel
​
RTLDIR=/path/to/rtl
CPUS = cpu1 cpu2
​
run_simulation_$(CPUS).html : $(RTLDIR)/$(CPUS)
	$(MT_MEGATEST) -runstep run_simulation_$(CPUS) -logpro runsim.logpro "runsim $(CPUS)
</pre>
</div>

</div>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-6.2">6.2</a> The main.csh file
</h2>
<div class="Standard">
<div class="listing">
<pre class="listing">#!/bin/tcsh -x
​
# run the cpu1 and cpu2 simulations in parallel. 
# The -j parameter tells make how many jobs it may run in parallel
​
<div class="left">
make -j 2 
</div>

$MT_MEGATEST -test-status :state COMPLETED :status $?
</pre>
</div>

</div>
<h1 class="Section">
<a class="toc" name="toc-Section-7">7</a> Simple Test with Iteration
</h1>
<div class="Standard">
Since no jobs run after the cpu1 and cpu2 simulations in this test it is possible to use iterated mode.
</div>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-7.1">7.1</a> Update your testconfig file for iteration
</h2>
<div class="Standard">
<div class="listing">
<pre class="listing">[setup]
runscript main.csh
<div class="left">

</div>

[items]
CPU cpu1 cpu2
</pre>
</div>

</div>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-7.2">7.2</a> Rewrite your main.csh for iteration
</h2>
<div class="Standard">
<div class="listing">
<pre class="listing">#!/bin/tcsh -x

# run the cpu simulation but now use the environment variable $CPU
# to select what cpu to run the simulation against

$MT_MEGATEST -runstep run_simulation -logpro runsim.logpro "runsim $CPU"
# As of version 1.07 Megatest automatically converts a status of "0"
# to "PASS", any other number to "FAIL" and directly uses the value of
# a string passed in.
$MT_MEGATEST -test-status :state COMPLETED :status $?
</pre>
</div>

</div>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-7.3">7.3</a> Tests with Inter-test dependencies
</h2>
<div class="Standard">
Sometimes a test depends on the output from a previous test or it may not make sense to run a test is another test does not complete with status “PASS”. In either of these scenarios you can use the “waiton” keyword in your testconfig file to indicate that this test must wait on one or more tests to complete before being launched. In this example there is no point in running the “system” test if the “cpu” and “mem” tests either do not complete or complete but with status “FAIL”.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing"># testconfig for the "system" test
[setup]
runscript main.csh
waiton cpu mem
</pre>
</div>

</div>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-7.4">7.4</a> Rolling up Miscellaneous Data
</h2>
<div class="Standard">
Use the -load-test-data switch to roll up arbitrary data from a test into the test_data table.
</div>
<div class="Standard">
<div class="listing">
<pre class="listing"># Fields are:
# category,variable,value,expected,tol,units,comment,status
​
$MT_MEGATEST -load-test-data &lt;&lt; EOF
foo,bar,1.2,1.9,&gt;
foo,rab,1.0e9,10e9,1e9
foo,bla,1.2,1.9,&lt;
foo,bal,1.2,1.2,&lt;,,Check for overload
foo,alb,1.2,1.2,&lt;=,Amps,This is the high power circuit test
foo,abl,1.2,1.3,0.1
foo,bra,1.2,pass,silly stuff
faz,bar,10,8mA,,,"this is a comment"
EOF
</pre>
</div>

</div>
<div class="Standard">
New entries are keyed on the category and variable. If a new record is inserted with a category and variable that have already been used the new record will replace the old record.
</div>
<div class="Standard">
Where value, expected and tol are specified the behavior is as follows.
</div>
<ul>
<li>
If value, expected and tol are numbers then status is calculated as PASS if (expected-tol) &lt;= value &lt;= (expected+tol)
</li>
<li>
If value and expected are numbers and tol is &gt;, &lt;, &gt;= or &lt;= then value is compared with expected using the operator given by tol
</li>
<li>
If status is specified its value overrides the above calculations.
</li>

</ul>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-7.5">7.5</a> Rolling up Runs
</h2>
<div class="Standard">
To roll up a number of tests in a sequence of runs to a single run use the -rollup command. 
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">megatest -rollup :sysname ubuntu :fsname nfs :datapath none :runname rollup_ww38
</pre>
</div>

</div>
<div class="Standard">
All keys must be specified and the runname is the name of the run that will be created. All paths are kept original inside the database. When -remove-runs is used to delete runs the data is not deleted if there are rollups that refer to the data. 
</div>
<h1 class="Section">
<a class="toc" name="toc-Section-8">8</a> Dashboard
</h1>
<div class="Standard">
<div class="listing">
<pre class="listing">&gt; dashboard &amp;
</pre>
</div>

</div>
<div class="Standard">
<img class="embedded" src="dashboard.png" alt="figure dashboard.png" style="width: 730px; max-width: 913px; height: 626px; max-height: 783px;"/>

</div>
<div class="Standard">
Pushing one of the buttons on the main dashboard will bring up the test specific dashboard. Values are updated in semi-real time as the test runs.
</div>
<div class="Standard">
<img class="embedded" src="dashboard-test.png" alt="figure dashboard-test.png" style="width: 643px; max-width: 804px; height: 571px; max-height: 714px;"/>

</div>
<h1 class="Section">
<a class="toc" name="toc-Section-9">9</a> Generating an OpenDocument Spreadsheet from the Database
</h1>
<div class="Standard">
And OpenDocument multi-paned spreadsheet can be generated from the megatest.db file by running -extract-ods
</div>
<div class="Standard">
<div class="listing">
<pre class="listing">megatest -extract-ods results.ods :runname % 
</pre>
</div>

</div>
<div class="Standard">
You can optionally specify the keys for your database to limit further the runs to extract into the spreadsheet. The first sheet contains all the run data and subsequent sheets contain data rolled up for the individual tests.
</div>
<h1 class="Section">
<a class="toc" name="toc-Section-10">10</a> Introspection
</h1>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-10.1">10.1</a> Getting previous test paths
</h2>
<div class="Standard">
<div class="listing">
<pre class="listing">megatest -test-paths -target %/%/% :runname % -testpatt % -itempatt % :status PASS 
</pre>
</div>

</div>
<h1 class="Section">
<a class="toc" name="toc-Section-11">11</a> Flows
</h1>
<div class="Standard">
A flow specifies the tests to run, the order and dependencies and is managed by a running megatest process.
</div>
<h1 class="Section">
<a class="toc" name="toc-Section-12">12</a> Flow Specification and Running (Not released yet)
</h1>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-12.1">12.1</a> Write your flow file
</h2>
<div class="Standard">
flows/&lt;flowname&gt;.config
</div>
<div class="Standard">
<div class="listing">
<pre class="listing"># Flow: &lt;flowname&gt;
[flowconfig]
# turn on item level dependencies
itemdeps on
​
[flowsteps]
# &lt;testname&gt;[,&lt;predecessor&gt;]
​
# Run the test "copydata"
copydata
​
# Run the test "setup" after copydata completes with PASS, WARN or WAIVE
setup,copydata
​
# once the test "setup" completes successfully run sim1, sim2 and sim3
sim1,setup
sim2,setup
sim3,setup
</pre>
</div>

</div>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-12.2">12.2</a> Run the flow
</h2>
<div class="Standard">
<div class="listing">
<pre class="listing">megatest -runflow &lt;flowname&gt; :FIELD1 val1 :FIELD2 val2 :runname wk32.4
</pre>
</div>

</div>
<h1 class="Section">
<a class="toc" name="toc-Section-13">13</a> Monitor based running
</h1>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-13.1">13.1</a> Monitor logic
</h2>
<div class="Standard">
Note: The monitor is usable but incomplete as of Megatest v1.31. Click on the &ldquo;Monitor&rdquo; button on the dashboard to start the monitor and give it a try.
</div>
<div class="Standard">
<img class="embedded" src="monitor-state-diagram.png" alt="figure monitor-state-diagram.png" style="max-width: 383px; max-height: 335px;"/>

</div>
<h1 class="Section">
<a class="toc" name="toc-Section-14">14</a> Reference
</h1>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-14.1">14.1</a> Configuration file Syntax
</h2>
<div class="Standard">
Note: whitespace is preserved including at the end of line. Ensure your entries only have whitespace at the end of line when needed to avoid problems.
</div>
<h3 class="Subsubsection">
<a class="toc" name="toc-Subsubsection-14.1.1">14.1.1</a> Sections
</h3>
<div class="Standard">
<div class="listing">
<pre class="listing">[section name]
</pre>
</div>

</div>
<div class="Standard">
This creates a section named “section name”
</div>
<h3 class="Subsubsection">
<a class="toc" name="toc-Subsubsection-14.1.2">14.1.2</a> Variables
</h3>
<div class="Standard">
<div class="listing">
<pre class="listing">VARX has this value
</pre>
</div>

</div>
<div class="Standard">
The variable “VARX” will have the value “has this value”
</div>
<h3 class="Subsubsection">
<a class="toc" name="toc-Subsubsection-14.1.3">14.1.3</a> Includes
</h3>
<div class="Standard">
<div class="listing">
<pre class="listing">[include filename]
</pre>
</div>

</div>
<div class="Standard">
The file named “filename” will be included as if part of the calling file. NOTE: This means no section can be named “include “ (with the whitespace).
</div>
<h3 class="Subsubsection">
<a class="toc" name="toc-Subsubsection-14.1.4">14.1.4</a> Setting a variable by running a command
</h3>
<div class="Standard">
<div class="listing">
<pre class="listing">VARNAME [system ls /tmp]
</pre>
</div>

</div>
<div class="Standard">
The variable “VARNAME” will get a value created by the Unix command “ls /tmp”. All lines of output from the command will be joined with a space.
</div>
<h3 class="Subsubsection">
<a class="toc" name="toc-Subsubsection-14.1.5">14.1.5</a> Notes
</h3>
<ul>
<li>
Some variables are infered as lists. Each token on the line separated by whitespace will be member of the list.
</li>
<li>
Comments (lines starting with #) and blank lines are ignored.
</li>

</ul>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-14.2">14.2</a> Environment variables
</h2>
<div class="Standard">
<table>
<tr>
<td align="left" valign="top" style="width: 10%;">
Variable
</td>
<td align="left" valign="top" style="width: 50%;">
Purpose
</td>

</tr>
<tr>
<td align="left" valign="top" style="width: 10%;">
MT_CMDINFO
</td>
<td align="left" valign="top" style="width: 50%;">
Conveys test variables to the megatest test runner.
</td>

</tr>
<tr>
<td align="left" valign="top" style="width: 10%;">
MT_TEST_RUN_DIR
</td>
<td align="left" valign="top" style="width: 50%;">
Directory assigned by megatest for the test to run.
</td>

</tr>
<tr>
<td align="left" valign="top" style="width: 10%;">
MT_TEST_NAME
</td>
<td align="left" valign="top" style="width: 50%;">
Name of the test, corrosponds to the directory name under tests.
</td>

</tr>
<tr>
<td align="left" valign="top" style="width: 10%;">
MT_ITEM_INFO
</td>
<td align="left" valign="top" style="width: 50%;">
Iterated tests will set this to a sequence of key/values ((KEY val) ...) 
</td>

</tr>
<tr>
<td align="left" valign="top" style="width: 10%;">
MT_RUN_AREA_HOME
</td>
<td align="left" valign="top" style="width: 50%;">
Directory where megatest was launched from and where the tests code can be found
</td>

</tr>
<tr>
<td align="left" valign="top" style="width: 10%;">
MT_RUNNAME
</td>
<td align="left" valign="top" style="width: 50%;">
Name of this run as set by the :runname parameter
</td>

</tr>
<tr>
<td align="left" valign="top" style="width: 10%;">
MT_MEGATEST
</td>
<td align="left" valign="top" style="width: 50%;">
Path/Filename to megatest executable. Found either from called path or but using the “exectuable” keyword in the [setup] section.
</td>

</tr>
<tr>
<td align="left" valign="top" style="width: 10%;">
&lt;field1&gt; ....
</td>
<td align="left" valign="top" style="width: 50%;">
The field values as set on the megatest -runall command line (e.g. :field1 abc)
</td>

</tr>

</table>

</div>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-14.3">14.3</a> megatest.config
</h2>
<div class="Standard">
<table>
<tr>
<td align="left" valign="top" style="width: 10%;">
section
</td>
<td align="left" valign="top" style="width: 15%;">
variable
</td>
<td align="left" valign="top" style="width: 20%;">
value
</td>
<td align="left" valign="top" style="width: 6%;">
required
</td>
<td align="left" valign="top" style="width: 20%;">
comment
</td>

</tr>
<tr>
<td align="left" valign="top" style="width: 10%;">
[setup]
</td>
<td align="left" valign="top" style="width: 15%;">
max_concurrent_jobs
</td>
<td align="left" valign="top" style="width: 20%;">
if variable is not defined no limit on jobs
</td>
<td align="left" valign="top" style="width: 6%;">
no
</td>
<td align="left" valign="top" style="width: 20%;">

</td>

</tr>
<tr>
<td align="left" valign="top" style="width: 10%;">

</td>
<td align="left" valign="top" style="width: 15%;">
executable
</td>
<td align="left" valign="top" style="width: 20%;">
full path to megatest binary
</td>
<td align="left" valign="top" style="width: 6%;">
no
</td>
<td align="left" valign="top" style="width: 20%;">
Use only if necessary, megatest will extract the location from where it used to launch and add append that to the PATH for test runs.
</td>

</tr>
<tr>
<td align="left" valign="top" style="width: 10%;">

</td>
<td align="left" valign="top" style="width: 15%;">
runsdir
</td>
<td align="left" valign="top" style="width: 20%;">
full path to where the link tree to all runs will be created
</td>
<td align="left" valign="top" style="width: 6%;">
no
</td>
<td align="left" valign="top" style="width: 20%;">
Because your runs may be spread out over several disk partitions a central link tree is created to make finding all the runs easy.
</td>

</tr>
<tr>
<td align="left" valign="top" style="width: 10%;">
[fields]
</td>
<td align="left" valign="top" style="width: 15%;">
string of letters, numbers and underscore
</td>
<td align="left" valign="top" style="width: 20%;">
string of letters, numbers and underscore
</td>
<td align="left" valign="top" style="width: 6%;">
at least one
</td>
<td align="left" valign="top" style="width: 20%;">

</td>

</tr>
<tr>
<td align="left" valign="top" style="width: 10%;">
[jobtools]
</td>
<td align="left" valign="top" style="width: 15%;">
launcher
</td>
<td align="left" valign="top" style="width: 20%;">
command line used to launch jobs - the job command (megatest -execute) will be appended to this
</td>
<td align="left" valign="top" style="width: 6%;">
no
</td>
<td align="left" valign="top" style="width: 20%;">

</td>

</tr>
<tr>
<td align="left" valign="top" style="width: 10%;">

</td>
<td align="left" valign="top" style="width: 15%;">
workhosts
</td>
<td align="left" valign="top" style="width: 20%;">
list of hostnames to run jobs on NOT SUPPORTED RIGHT NOW
</td>
<td align="left" valign="top" style="width: 6%;">
n/a
</td>
<td align="left" valign="top" style="width: 20%;">

</td>

</tr>
<tr>
<td align="left" valign="top" style="width: 10%;">
[jobgroups]
</td>
<td align="left" valign="top" style="width: 15%;">
string of letters, numbers and underscore
</td>
<td align="left" valign="top" style="width: 20%;">
number
</td>
<td align="left" valign="top" style="width: 6%;">
no
</td>
<td align="left" valign="top" style="width: 20%;">
Control number of jobs allowed to concurrently run in categories. See [jobgroup] in testconfig
</td>

</tr>
<tr>
<td align="left" valign="top" style="width: 10%;">
[env-override]
</td>
<td align="left" valign="top" style="width: 15%;">
string of letters, numbers and underscore
</td>
<td align="left" valign="top" style="width: 20%;">
any string
</td>
<td align="left" valign="top" style="width: 6%;">
no
</td>
<td align="left" valign="top" style="width: 20%;">
These are set on the test launching machine, not the test running machine. Typical usage is to control the host or run queue for launching tests. These values will not be seen by the test when it runs.
</td>

</tr>
<tr>
<td align="left" valign="top" style="width: 10%;">
[disks]
</td>
<td align="left" valign="top" style="width: 15%;">
string of letters, numbers and underscore
</td>
<td align="left" valign="top" style="width: 20%;">
a valid path writable by the test launching process and by the test process
</td>
<td align="left" valign="top" style="width: 6%;">
yes
</td>
<td align="left" valign="top" style="width: 20%;">
The disk usage balancing algorithm is to choose the disk with the least space for each test run. 
</td>

</tr>

</table>

</div>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-14.4">14.4</a> runconfigs.config file
</h2>
<div class="Standard">
<table>
<tr>
<td align="left" valign="top" style="width: 20%;">
section
</td>
<td align="left" valign="top" style="width: 12%;">
variable
</td>
<td align="left" valign="top" style="width: 3%;">
value
</td>
<td align="left" valign="top" style="width: 4%;">
required?
</td>
<td align="left" valign="top" style="width: 30%;">
comment
</td>

</tr>
<tr>
<td align="left" valign="top" style="width: 20%;">
[default]
</td>
<td align="left" valign="top" style="width: 12%;">
string of letters, numbers and underscore
</td>
<td align="left" valign="top" style="width: 3%;">
any
</td>
<td align="left" valign="top" style="width: 4%;">
no
</td>
<td align="left" valign="top" style="width: 30%;">
variables set in this section will be available for all runs, defining the same variable in another section will override the value from the default section
</td>

</tr>
<tr>
<td align="left" valign="top" style="width: 20%;">
[field1value/field2value...]
</td>
<td align="left" valign="top" style="width: 12%;">
string of letters, numbers and underscore
</td>
<td align="left" valign="top" style="width: 3%;">
any
</td>
<td align="left" valign="top" style="width: 4%;">
no
</td>
<td align="left" valign="top" style="width: 30%;">
the values in this section will be set for any run where field1 is field1value, field2 is field2value and fieldN is fieldNvalue. 
</td>

</tr>

</table>

</div>
<div class="Standard">
Example: a test suite that checks that a piece of software works correctly for different customer configurations and locations each of which is done as a separate release regression run. The fields, CUSTOMER and LOCATION were chosen. The following runconfigs.config file would set some variables specific to runs for megacorp in India and femtocorp in the Cook Islands and New Zealand:
</div>
<div class="Standard">
<div class="listing">
<pre class="listing"># runconfigs.config
[default]
ENCRYTION true
​
[megacorp/india]
TESTPATH /nfs/testing/megacorp_runs
​
[femtocorp/cook_islands]
ENCRYTION false
TESTPATH /afs/kiatoa/testing/cook_islands
​
[femtocorp/new_zealand]
TESTPATH /afs/kiatoa/testing/new_zealand
​
[megacorp/new_zealand]
TESTPATH /nfs/testing/megacorp_runs
</pre>
</div>

</div>
<div class="Paragraph-">
<a class="toc" name="toc-Paragraph--1"></a>Running megatest like this:
</div>
<div class="Code">
megatest :CUSTOMER megacorp :LOCATION new_zealand :runname week12_2011_run1 -runall
</div>
<div class="Paragraph-">
<a class="toc" name="toc-Paragraph--2"></a>Would set:
</div>
<div class="Code">
ENCRYPTION true
</div>
<div class="Code">
TESTPATH /nfs/testing/megacorp_runs
</div>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-14.5">14.5</a> Writing tests
</h2>
<h3 class="Subsubsection">
<a class="toc" name="toc-Subsubsection-14.5.1">14.5.1</a> testconfig file
</h3>
<div class="Standard">
<table>
<tr>
<td align="left" valign="top" style="width: 8%;">
section
</td>
<td align="left" valign="top" style="width: 6%;">
variable
</td>
<td align="left" valign="top" style="width: 12%;">
value
</td>
<td align="left" valign="top" style="width: 6%;">
required?
</td>
<td align="left" valign="top" style="width: 30%;">
comments
</td>

</tr>
<tr>
<td align="left" valign="top" style="width: 8%;">
[setup]
</td>
<td align="left" valign="top" style="width: 6%;">
runscript
</td>
<td align="left" valign="top" style="width: 12%;">
name of script to execute for this test
</td>
<td align="left" valign="top" style="width: 6%;">
yes
</td>
<td align="left" valign="top" style="width: 30%;">
The script must be executable and either provide the full path or put a copy at the top of your test directory
</td>

</tr>
<tr>
<td align="left" valign="top" style="width: 8%;">
[requirements]
</td>
<td align="left" valign="top" style="width: 6%;">
waiton
</td>
<td align="left" valign="top" style="width: 12%;">
list of valid test names
</td>
<td align="left" valign="top" style="width: 6%;">
no
</td>
<td align="left" valign="top" style="width: 30%;">
This test will not run until the named tests are state completed and status PASS
</td>

</tr>
<tr>
<td align="left" valign="top" style="width: 8%;">

</td>
<td align="left" valign="top" style="width: 6%;">
jobgroup
</td>
<td align="left" valign="top" style="width: 12%;">

</td>
<td align="left" valign="top" style="width: 6%;">

</td>
<td align="left" valign="top" style="width: 30%;">

</td>

</tr>
<tr>
<td align="left" valign="top" style="width: 8%;">
[items]
</td>
<td align="left" valign="top" style="width: 6%;">
any valid
</td>
<td align="left" valign="top" style="width: 12%;">
list of values
</td>
<td align="left" valign="top" style="width: 6%;">
no
</td>
<td align="left" valign="top" style="width: 30%;">
The test will be repeated once for each item with the variable name set to the value. If there is more than one variable then the test will be run against all unique combinations of the values
</td>

</tr>
<tr>
<td align="left" valign="top" style="width: 8%;">
[eztests]
</td>
<td align="left" valign="top" style="width: 6%;">
any valid
</td>
<td align="left" valign="top" style="width: 12%;">
stepname command
</td>
<td align="left" valign="top" style="width: 6%;">
no
</td>
<td align="left" valign="top" style="width: 30%;">
Use in addition to or instead of runscript for easy implementation of steps. If &lt;stepname&gt;.logpro exists it will be applied to the &lt;stepname&gt;.log and resulting exit code will be used to determine PASS/FAIL/WARN
</td>

</tr>

</table>

</div>
<h3 class="Subsubsection">
<a class="toc" name="toc-Subsubsection-14.5.2">14.5.2</a> Command line
</h3>
<div class="Standard">
<table>
<tr>
<td align="left" valign="top">
switch or param
</td>
<td align="left" valign="top">
parameter
</td>
<td align="left" valign="top" style="width: 30%;">
purpose
</td>
<td align="left" valign="top">
comments
</td>

</tr>
<tr>
<td align="left" valign="top">
-h
</td>
<td align="left" valign="top">

</td>
<td align="left" valign="top" style="width: 30%;">
brief help
</td>
<td align="left" valign="top">

</td>

</tr>
<tr>
<td align="left" valign="top">
-runall
</td>
<td align="left" valign="top">

</td>
<td align="left" valign="top" style="width: 30%;">
run all tests
</td>
<td align="left" valign="top">

</td>

</tr>
<tr>
<td align="left" valign="top">
-runtests
</td>
<td align="left" valign="top">
test1,test2,...
</td>
<td align="left" valign="top" style="width: 30%;">
run one or more tests
</td>
<td align="left" valign="top">

</td>

</tr>
<tr>
<td align="left" valign="top">
-step
</td>
<td align="left" valign="top">
stepname
</td>
<td align="left" valign="top" style="width: 30%;">
record a step
</td>
<td align="left" valign="top">
requires :state and :status
</td>

</tr>
<tr>
<td align="left" valign="top">
-test-status
</td>
<td align="left" valign="top">

</td>
<td align="left" valign="top" style="width: 30%;">
record the test status
</td>
<td align="left" valign="top">
requires :state and :status
</td>

</tr>
<tr>
<td align="left" valign="top">
-setlog
</td>
<td align="left" valign="top">
logfilename
</td>
<td align="left" valign="top" style="width: 30%;">
set the logfile name for a test
</td>
<td align="left" valign="top">
path is assumed to be relative to the test run directory
</td>

</tr>
<tr>
<td align="left" valign="top">
-set-toplog
</td>
<td align="left" valign="top">
logfilename
</td>
<td align="left" valign="top" style="width: 30%;">
set the logfile name for the top test in an iterated test run
</td>
<td align="left" valign="top">
each sub test can have its own logfile set
</td>

</tr>
<tr>
<td align="left" valign="top">
-m
</td>
<td align="left" valign="top">
&ldquo;comment&rdquo;
</td>
<td align="left" valign="top" style="width: 30%;">
sets a comment for the step, test or run
</td>
<td align="left" valign="top">

</td>

</tr>
<tr>
<td align="left" valign="top">
:runname
</td>
<td align="left" valign="top">
[a-zA-Z0-9_-]+
</td>
<td align="left" valign="top" style="width: 30%;">
directory in which this run will be stored in the test run area 
</td>
<td align="left" valign="top">

</td>

</tr>
<tr>
<td align="left" valign="top">
:state
</td>
<td align="left" valign="top">
any value
</td>
<td align="left" valign="top" style="width: 30%;">
Set the step or test state, this is stored in the state field in the steps or tests table respectively
</td>
<td align="left" valign="top">
For tests Megatest recognises &ldquo;INCOMPLETE&rdquo;, &ldquo;COMPLETE&rdquo;
</td>

</tr>
<tr>
<td align="left" valign="top">
:status
</td>
<td align="left" valign="top">
any value
</td>
<td align="left" valign="top" style="width: 30%;">
Set the step or test status, this is stored in the status field in the steps or tests table respectively
</td>
<td align="left" valign="top">
For tests Megatest recognises &ldquo;PASS&rdquo;, &ldquo;FAIL&rdquo;, and &ldquo;CHECK&rdquo;
</td>

</tr>
<tr>
<td align="left" valign="top">
-list-runs
</td>
<td align="left" valign="top">
any value, % is wildcard
</td>
<td align="left" valign="top" style="width: 30%;">
Respects -itempatt and -testpatt for filters
</td>
<td align="left" valign="top">

</td>

</tr>
<tr>
<td align="left" valign="top">
-testpatt
</td>
<td align="left" valign="top">
any value, % is wildcard
</td>
<td align="left" valign="top" style="width: 30%;">

</td>
<td align="left" valign="top">

</td>

</tr>
<tr>
<td align="left" valign="top">
-itempatt
</td>
<td align="left" valign="top">
any value, % is wildcard
</td>
<td align="left" valign="top" style="width: 30%;">

</td>
<td align="left" valign="top">

</td>

</tr>
<tr>
<td align="left" valign="top">
-showkeys
</td>
<td align="left" valign="top">

</td>
<td align="left" valign="top" style="width: 30%;">
Print the keys being used for this database
</td>
<td align="left" valign="top">

</td>

</tr>
<tr>
<td align="left" valign="top">
-force
</td>
<td align="left" valign="top">

</td>
<td align="left" valign="top" style="width: 30%;">
Test will not re-run if in the &ldquo;PASS&rdquo;, &ldquo;CHECK&rdquo; or &ldquo;KILLED&rdquo;, using -force will force the run to be launched.
</td>
<td align="left" valign="top">
WARNING: The -force switch will bypass any &ldquo;waiton&rdquo; dependencies.
</td>

</tr>
<tr>
<td align="left" valign="top">
-xterm
</td>
<td align="left" valign="top">

</td>
<td align="left" valign="top" style="width: 30%;">
Launch an xterm instead of run the test. The xterm will have the environment that the test would see.
</td>
<td align="left" valign="top">

</td>

</tr>
<tr>
<td align="left" valign="top">
-remove-runs
</td>
<td align="left" valign="top">

</td>
<td align="left" valign="top" style="width: 30%;">
Remove a run, test or subtest from the database and the disk. Cannot be undone. Requires -testpatt, -itempatt, :runname and all keys be specified.
</td>
<td align="left" valign="top">

</td>

</tr>
<tr>
<td align="left" valign="top">
<i>Test helpers</i>
</td>
<td align="left" valign="top">

</td>
<td align="left" valign="top" style="width: 30%;">

</td>
<td align="left" valign="top">

</td>

</tr>
<tr>
<td align="left" valign="top">
-runstep
</td>
<td align="left" valign="top">

</td>
<td align="left" valign="top" style="width: 30%;">
Used inside a test to run a step, record the start and end of the step and optionally analyze the output using logpro.
</td>
<td align="left" valign="top">

</td>

</tr>
<tr>
<td align="left" valign="top">
-logpro
</td>
<td align="left" valign="top">

</td>
<td align="left" valign="top" style="width: 30%;">
If using logpro to acess the PASS/FAIL status of the step you specify the logpro file with this parameter.
</td>
<td align="left" valign="top">

</td>

</tr>

</table>

</div>
<h1 class="Section">
<a class="toc" name="toc-Appendix-A">A</a> Data
</h1>
<h1 class="Section">
<a class="toc" name="toc-Appendix-B">B</a> References
</h1>

<hr class="footer"/>
<div class="footer" id="generated-by">
Document generated by <a href="http://elyxer.nongnu.org/">eLyXer 1.2.2 (2011-06-12)</a> on <span class="create-date">2012-01-29T18:44:54.893148</span>
</div>
</div>
</body>
</html>
